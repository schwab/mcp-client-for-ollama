# JSONL Viewer/Editor - User Guide

## Overview

The JSONL Viewer/Editor is a web-based tool for viewing, editing, and managing JSONL (JSON Lines) files in the data folder. It provides an intuitive interface for working with large JSONL files generated by the improvement pipeline.

## Access

Navigate to: **`/jsonl-viewer`**

Or from the API info endpoint at `/api`, look for the `jsonl_viewer` page link.

## Features

### File Management
- **File List** - Browse all JSONL files in the data folder
- **File Info** - View file size, line count, and modification time
- **Quick Access** - Click any file to load it

### Viewing
- **Pagination** - Navigate through large files with configurable page sizes (10, 25, 50, or 100 lines per page)
- **Line Display** - Each line is formatted with line numbers and highlighted JSON
- **Statistics Panel** - View file statistics including:
  - Total lines
  - Valid/invalid JSON count
  - File size
  - Unique keys count
  - Sample JSON object

### Editing
- **Edit Lines** - Click "Edit" on any line to modify it
- **Delete Lines** - Remove individual lines from the file
- **Add Lines** - Add new JSON objects to the file
- **Validate JSON** - Check file integrity before modifications

### Search & Analysis
- **Search** - Find lines matching a query (full-text search)
- **Validation** - Verify file structure and identify invalid JSON
- **Export** - Download file data as JSON

## API Endpoints

All endpoints are prefixed with `/api/jsonl`

### List Files
```
GET /api/jsonl/list
```
Returns list of all JSONL files with metadata.

**Response:**
```json
{
  "folder": "/path/to/data",
  "files": [
    {
      "name": "file.jsonl",
      "path": "file.jsonl",
      "size": 1024,
      "lines": 10,
      "modified": 1234567890
    }
  ],
  "count": 1
}
```

### Get Content
```
GET /api/jsonl/content?file=FILE_NAME&page=1&per_page=50
```
Get paginated content from a file.

**Query Parameters:**
- `file` (required) - Filename relative to data folder
- `page` (optional) - Page number (default: 1)
- `per_page` (optional) - Lines per page (default: 50)

**Response:**
```json
{
  "file": "file.jsonl",
  "page": 1,
  "per_page": 50,
  "total_lines": 100,
  "total_pages": 2,
  "lines": [
    {"key": "value"},
    ...
  ]
}
```

### Search
```
POST /api/jsonl/search
```
Search for lines matching a query.

**Request Body:**
```json
{
  "file": "file.jsonl",
  "query": "search_term",
  "limit": 100
}
```

**Response:**
```json
{
  "file": "file.jsonl",
  "query": "search_term",
  "results_count": 5,
  "results": [
    {
      "line_num": 1,
      "content": {"key": "value"}
    }
  ]
}
```

### Edit Line
```
POST /api/jsonl/edit
```
Modify a specific line in a file.

**Request Body:**
```json
{
  "file": "file.jsonl",
  "line_num": 1,
  "content": {"new": "data"}
}
```

### Delete Line
```
POST /api/jsonl/delete-line
```
Remove a line from a file.

**Request Body:**
```json
{
  "file": "file.jsonl",
  "line_num": 1
}
```

### Add Line
```
POST /api/jsonl/add-line
```
Add a new line to a file.

**Request Body:**
```json
{
  "file": "file.jsonl",
  "content": {"new": "data"},
  "position": -1
}
```

### Validate File
```
POST /api/jsonl/validate
```
Validate JSONL file format.

**Request Body:**
```json
{
  "file": "file.jsonl"
}
```

**Response:**
```json
{
  "file": "file.jsonl",
  "valid": true,
  "valid_lines": 100,
  "error_count": 0,
  "errors": []
}
```

### File Statistics
```
GET /api/jsonl/stats?file=FILE_NAME
```
Get detailed statistics about a file.

**Response:**
```json
{
  "file": "file.jsonl",
  "size": 1024,
  "lines": 10,
  "valid_json": 10,
  "invalid_json": 0,
  "keys": {
    "key1": 10,
    "key2": 8
  },
  "sample": {"key": "value"}
}
```

## Configuration

### Data Folder
By default, the viewer points to: `~/Nextcloud/DEV/ollmcp/mcp-client-for-ollama/data/`

To change the data folder, set the environment variable:
```bash
export JSONL_DATA_FOLDER=/path/to/data/folder
```

## Use Cases

### Reviewing Improvement Pipeline Results
1. Navigate to JSONL Viewer
2. Select `improvement_report_*.json` file
3. Review metrics and recommendations

### Analyzing Training Data
1. Open `agent_training_examples.jsonl`
2. Search for specific training examples
3. Edit or delete problematic entries

### Validating Fine-tuning Datasets
1. Select `tool_calling.jsonl` or other dataset
2. Click "Validate" to check format
3. Fix any invalid JSON lines

### Exporting Data
1. Open desired file
2. Click "Export" to download
3. Use for external analysis or processing

## Tips & Tricks

### Large Files
- Use smaller page sizes (10-25) for better performance
- Use search to narrow down results
- Validate before editing

### Editing
- Click a line to edit it
- JSON must be valid (check syntax)
- Use "Validate" after bulk edits

### Search
- Search is case-insensitive
- Searches entire JSON object content
- Limited to 100 results

### Performance
- Files are read lazily (only displayed lines are processed)
- Search is indexed on-demand
- Statistics are cached until file is modified

## Troubleshooting

### File not found
- Verify the file exists in the data folder
- Check folder configuration with JSONL_DATA_FOLDER

### Invalid JSON error
- JSON must be valid on each line
- Use "Validate" to identify problematic lines
- Check for unescaped quotes or special characters

### Permission denied
- Ensure the data folder is readable
- Check file permissions
- Verify application has write access

### Changes not saving
- Check file write permissions
- Verify JSON is valid
- Check browser console for errors

## Security

- File access is restricted to the configured data folder
- Directory traversal attacks are prevented
- All paths are validated

## Browser Compatibility

- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- Mobile browsers supported

## Keyboard Shortcuts

- `Ctrl/Cmd + K` - Focus search box (when implemented)
- `Escape` - Close modals
- `Enter` - Submit forms

## Future Enhancements

Planned features:
- Bulk edit operations
- Advanced filtering
- Side-by-side comparison
- Line diffing
- Export to CSV
- Batch operations
- Real-time collaboration

## Support

For issues or questions:
1. Check the troubleshooting section above
2. Review the API documentation
3. Check browser console for errors
4. Contact support with file details (name, size, error message)
